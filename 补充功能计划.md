# ç§‘ç ”å®¡ç¨¿ç³»ç»Ÿ - è¡¥å……åŠŸèƒ½å®ç°è®¡åˆ’

## ğŸ“‹ é¡¹ç›®å®ŒæˆçŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæˆï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
| åŠŸèƒ½é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|------|
| ç³»ç»Ÿæ¶æ„ (C/S) | âœ… | TCP åŒå‘é€šä¿¡ |
| è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ | âœ… | SuperBlock/Inode/Bitmap |
| åŸºç¡€æ–‡ä»¶æ“ä½œ | âœ… | create/delete/read/write |
| ç›®å½•æ“ä½œ | âœ… | mkdir/rmdir å·²ä¿®å¤æƒé™ |
| ç”¨æˆ·è®¤è¯ | âœ… | 4ä¸ªè§’è‰²å®šä¹‰ |
| LRU ç¼“å­˜ | âœ… | 16MB Block ç¼“å­˜ |
| è®ºæ–‡çŠ¶æ€æœº | âœ… | 5ç§çŠ¶æ€æµè½¬ |
| å¹¶å‘å¤„ç† | âœ… | çº¿ç¨‹æ±  + mutex |
| ç½‘ç»œåè®® | âœ… | 12ç§å‘½ä»¤ |

### âŒ å¾…å®Œæˆï¼ˆéœ€è¦è¡¥å……ï¼‰

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆä¼šè®®ç­”è¾©å¿…éœ€ï¼‰
1. **ç¼–è¾‘è§’è‰²å®Œå–„**
   - è§’è‰²å®šä¹‰: ROLE_EDITOR 
   - æƒé™æ“ä½œ: åˆ†é…å®¡ç¨¿äººã€å†³ç­–
   
2. **å¤‡ä»½ç³»ç»Ÿï¼ˆ10å°æ—¶ï¼‰**
   - åˆ›å»ºå¤‡ä»½: `backup create <desc>`
   - åˆ—å‡ºå¤‡ä»½: `backup list`
   - æ¢å¤å¤‡ä»½: `backup restore <version>`
   
3. **è¯„å®¡æ„è§ç®¡ç†ï¼ˆ4.5å°æ—¶ï¼‰**
   - ä¸Šä¼ è¯„å®¡: `upload_review <paper> <opinion>`
   - æŸ¥è¯¢è¯„å®¡: `query_review <paper>`
   - ä¸‹è½½æ„è§: `download_review <paper>`

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæé«˜åˆ†æ•°ï¼‰
4. **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ˆ4å°æ—¶ï¼‰**
   - åˆ›å»ºç”¨æˆ·: `useradd <username> <role>`
   - åˆ é™¤ç”¨æˆ·: `userdel <username>`
   - æŸ¥è¯¢ç”¨æˆ·: `userlist`
   
5. **ç³»ç»ŸçŠ¶æ€æŸ¥çœ‹ï¼ˆ3å°æ—¶ï¼‰**
   - ç£ç›˜ä½¿ç”¨: `status`
   - ç¼“å­˜ç»Ÿè®¡: çŠ¶æ€ä¸­æ˜¾ç¤º
   - æ´»è·ƒè¿æ¥: çŠ¶æ€ä¸­æ˜¾ç¤º
   
6. **å®¢æˆ·ç«¯å¢å¼ºï¼ˆ3.5å°æ—¶ï¼‰**
   - è§’è‰²æ„ŸçŸ¥å¸®åŠ©
   - æƒé™æå‰æ£€æŸ¥
   - æ–°å‘½ä»¤è§£æ

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆåŠ åˆ†é¡¹ï¼‰
7. **è®ºæ–‡ç‰ˆæœ¬ç®¡ç†ï¼ˆ3å°æ—¶ï¼‰**
   - ç‰ˆæœ¬ä¸Šä¼ : `submit_revision <paper> <version>`
   - ç‰ˆæœ¬åˆ—è¡¨: `list_revisions <paper>`

---

## ğŸ› ï¸ è¯¦ç»†å®ç°æŒ‡å—

### ä¼˜å…ˆçº§ 1ï¸âƒ£: ç¼–è¾‘è§’è‰²æ‰©å±•ï¼ˆ1.5 å°æ—¶ï¼‰

```c
// include/common.h ä¿®æ”¹
typedef enum {
    ROLE_GUEST      = 0,
    ROLE_AUTHOR     = 1,
    ROLE_REVIEWER   = 2,
    ROLE_EDITOR     = 3,  // æ–°å¢
    ROLE_ADMIN      = 4,  // è°ƒæ•´
} UserRole;
```

**å½±å“èŒƒå›´ï¼š** common.h, server.cï¼ˆæƒé™æ£€æŸ¥ï¼‰

---

### ä¼˜å…ˆçº§ 2ï¸âƒ£: å¤‡ä»½ç³»ç»Ÿå®ç°ï¼ˆ10 å°æ—¶ï¼‰

#### 2.1 å¤‡ä»½æ•°æ®ç»“æ„ (include/vfs.h)
```c
typedef struct {
    uint32_t backup_id;
    time_t created_at;
    char description[256];
    uint32_t size;
    char checksum[64];
} BackupMetadata;
```

#### 2.2 VFS å±‚æ¥å£ (src/vfs.c)
- `int vfs_create_backup(VFSContext *ctx, const char *desc)`
- `int vfs_list_backups(VFSContext *ctx, BackupMetadata *metas, int *count)`
- `int vfs_restore_backup(VFSContext *ctx, uint32_t backup_id)`

#### 2.3 Protocol å±‚å‘½ä»¤ (include/common.h)
```c
typedef enum {
    // ... ç°æœ‰å‘½ä»¤
    CMD_BACKUP_CREATE = 20,
    CMD_BACKUP_LIST = 21,
    CMD_BACKUP_RESTORE = 22,
} CommandType;
```

#### 2.4 Server å±‚å¤„ç† (src/server.c)
- `server_handle_backup_create()` - åˆ›å»ºå¤‡ä»½
- `server_handle_backup_list()` - åˆ—å‡ºå¤‡ä»½
- `server_handle_backup_restore()` - æ¢å¤å¤‡ä»½

#### 2.5 å®¢æˆ·ç«¯å‘½ä»¤ (src/client.c)
```
backup create <description>   # åˆ›å»ºå¤‡ä»½
backup list                   # åˆ—å‡ºå¤‡ä»½
backup restore <backup_id>    # æ¢å¤å¤‡ä»½
```

---

### ä¼˜å…ˆçº§ 3ï¸âƒ£: è¯„å®¡æ„è§ç®¡ç†ï¼ˆ4.5 å°æ—¶ï¼‰

#### 3.1 æ•°æ®ç»“æ„ (include/common.h)
```c
typedef struct {
    uint32_t paper_id;
    uint32_t reviewer_id;
    int score;              // 1-10 åˆ†
    char comments[1024];
    time_t submitted_at;
} ReviewPayload;
```

#### 3.2 Server å±‚å¤„ç† (src/server.c)
- `server_handle_upload_review()` - å®¡ç¨¿äººä¸Šä¼ è¯„å®¡
- `server_handle_query_review()` - æŸ¥è¯¢è®ºæ–‡è¯„å®¡

#### 3.3 Protocol å‘½ä»¤ (include/common.h)
```c
CMD_UPLOAD_REVIEW = 23,
CMD_QUERY_REVIEW = 24,
```

#### 3.4 å®¢æˆ·ç«¯å‘½ä»¤ (src/client.c)
```
upload_review <paper_id> <score> <comments>
query_review <paper_id>
```

---

### ä¼˜å…ˆçº§ 4ï¸âƒ£: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ˆ4 å°æ—¶ï¼‰

#### 4.1 ç”¨æˆ·æ•°æ®åº“ç»“æ„
- å­˜å‚¨ä½ç½®: `/.admin/users.db`
- æ ¼å¼: äºŒè¿›åˆ¶ æˆ– JSON
- åŒ…å«: username, password_hash, role, email, created_at

#### 4.2 VFS æ¥å£ (src/vfs.c)
- `int vfs_user_add(VFSContext *ctx, const char *username, const char *password, UserRole role)`
- `int vfs_user_delete(VFSContext *ctx, const char *username)`
- `int vfs_user_list(VFSContext *ctx, ...)`
- `int vfs_user_exists(VFSContext *ctx, const char *username)`

#### 4.3 Protocol å‘½ä»¤
```c
CMD_USER_ADD = 25,
CMD_USER_DELETE = 26,
CMD_USER_LIST = 27,
CMD_USER_INFO = 28,
```

#### 4.4 å®¢æˆ·ç«¯å‘½ä»¤
```
useradd <username> <role>      # åˆ›å»ºç”¨æˆ·
userdel <username>              # åˆ é™¤ç”¨æˆ·
userlist                        # åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
```

---

### ä¼˜å…ˆçº§ 5ï¸âƒ£: ç³»ç»ŸçŠ¶æ€æŸ¥çœ‹ï¼ˆ3 å°æ—¶ï¼‰

#### 5.1 ç»Ÿè®¡ä¿¡æ¯ç»“æ„ (include/server.h)
```c
typedef struct {
    uint32_t total_blocks;
    uint32_t free_blocks;
    uint32_t used_blocks;
    uint32_t active_clients;
    uint32_t total_requests;
    float cache_hit_rate;
    time_t uptime;
} SystemStatus;
```

#### 5.2 æ”¶é›†ç»Ÿè®¡ (src/server.c)
- åœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†åæ›´æ–°è®¡æ•°å™¨
- è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡
- è®°å½•æ´»è·ƒè¿æ¥æ•°

#### 5.3 Protocol å‘½ä»¤
```c
CMD_SYSTEM_STATUS = 29,
```

#### 5.4 å®¢æˆ·ç«¯å‘½ä»¤
```
status                          # æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
```

---

## ğŸ“Š å®ç°æ—¶é—´è¡¨

| ä¼˜å…ˆçº§ | åŠŸèƒ½æ¨¡å— | é¢„è®¡å·¥æ—¶ | éš¾åº¦ | å¼€å§‹æ—¶é—´ |
|--------|---------|---------|------|---------|
| 1 | ç¼–è¾‘è§’è‰² | 1.5h | â­ | Day 1 |
| 2 | å¤‡ä»½ç³»ç»Ÿ | 10h | â­â­â­ | Day 2-3 |
| 3 | è¯„å®¡æ„è§ | 4.5h | â­â­ | Day 4 |
| 4 | ç”¨æˆ·ç®¡ç† | 4h | â­â­ | Day 5 |
| 5 | ç³»ç»ŸçŠ¶æ€ | 3h | â­ | Day 6 |
| 6 | å®¢æˆ·ç«¯å¢å¼º | 3.5h | â­â­ | Day 6-7 |
| 7 | ç‰ˆæœ¬ç®¡ç† | 3h | â­â­ | Day 8 (å¯é€‰) |

**æ€»è®¡:** çº¦ 29-32 å°æ—¶å·¥ä½œ

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### ç¼–è¾‘è§’è‰²æµ‹è¯•
- [ ] ç¼–è¾‘èƒ½ä»¥ role=3 ç™»å½•
- [ ] ç¼–è¾‘èƒ½åˆ†é…å®¡ç¨¿äºº
- [ ] ç¼–è¾‘èƒ½åšå‡ºæœ€ç»ˆå†³å®š
- [ ] éç¼–è¾‘æ— æ³•æ‰§è¡Œç¼–è¾‘æƒé™æ“ä½œ

### å¤‡ä»½ç³»ç»Ÿæµ‹è¯•
- [ ] èƒ½åˆ›å»ºå¤‡ä»½ï¼Œè¿”å›å¤‡ä»½ID
- [ ] èƒ½åˆ—å‡ºæ‰€æœ‰å¤‡ä»½åŠæ—¶é—´æˆ³
- [ ] èƒ½ä»å¤‡ä»½æ¢å¤ï¼Œæ•°æ®å®Œæ•´
- [ ] å¤šæ¬¡åˆ›å»º/æ¢å¤ä¸å†²çª
- [ ] ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œå¤‡ä»½æ“ä½œ

### è¯„å®¡æ„è§æµ‹è¯•
- [ ] å®¡ç¨¿äººèƒ½ä¸Šä¼ è¯„å®¡æ„è§
- [ ] ä»»ä½•äººèƒ½æŸ¥è¯¢è¯„å®¡ï¼ˆå¯èƒ½æœ‰æƒé™é™åˆ¶ï¼‰
- [ ] è¯„å®¡æ•°æ®æŒä¹…åŒ–å­˜å‚¨
- [ ] è¯„å®¡æ”¯æŒå¤šæ¡ï¼ˆä¸€ç¯‡è®ºæ–‡å¤šä¸ªè¯„å®¡ï¼‰

### ç”¨æˆ·ç®¡ç†æµ‹è¯•
- [ ] ç®¡ç†å‘˜èƒ½åˆ›å»ºç”¨æˆ·
- [ ] ç®¡ç†å‘˜èƒ½åˆ é™¤ç”¨æˆ·
- [ ] ç®¡ç†å‘˜èƒ½æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
- [ ] é‡å¤åˆ›å»ºç”¨æˆ·è¿”å›é”™è¯¯
- [ ] æ–°åˆ›å»ºçš„ç”¨æˆ·èƒ½æ­£å¸¸ç™»å½•

### ç³»ç»ŸçŠ¶æ€æµ‹è¯•
- [ ] èƒ½æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
- [ ] èƒ½æŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡
- [ ] èƒ½æŸ¥çœ‹æ´»è·ƒè¿æ¥æ•°
- [ ] çŠ¶æ€ä¿¡æ¯å®æ—¶æ›´æ–°

---

## ğŸ“ æäº¤ææ–™

æœ€ç»ˆéœ€è¦æäº¤ï¼š
- [ ] æºä»£ç ï¼ˆæ‰€æœ‰ä¿®æ”¹ï¼‰
- [ ] ç¼–è¯‘è„šæœ¬ï¼ˆMakefileï¼‰
- [ ] å¯æ‰§è¡Œç¨‹åºï¼ˆprfs_server, prfs_clientï¼‰
- [ ] æ¼”ç¤ºè„šæœ¬ï¼ˆå±•ç¤ºæ‰€æœ‰åŠŸèƒ½çš„å‘½ä»¤é›†åˆï¼‰
- [ ] é¡¹ç›®æ–‡æ¡£ï¼ˆåŠŸèƒ½è¯´æ˜ã€æ¶æ„ã€APIï¼‰
- [ ] å®éªŒæŠ¥å‘Šï¼ˆä»»åŠ¡åˆ†é…ã€å®Œæˆæƒ…å†µã€æµ‹è¯•ç»“æœï¼‰

---

## ğŸ’¡ å»ºè®®å®ç°é¡ºåº

```
ç¬¬1å¤©: ç¼–è¾‘è§’è‰² + å¤‡ä»½ç³»ç»Ÿæ¡†æ¶
ç¬¬2å¤©: å¤‡ä»½åˆ›å»º/åˆ—å‡º/æ¢å¤åŠŸèƒ½
ç¬¬3å¤©: è¯„å®¡æ„è§ä¸Šä¼ /æŸ¥è¯¢
ç¬¬4å¤©: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
ç¬¬5å¤©: ç³»ç»ŸçŠ¶æ€æŸ¥çœ‹ + å®¢æˆ·ç«¯å¢å¼º
ç¬¬6å¤©: åŠŸèƒ½é›†æˆæµ‹è¯•
ç¬¬7å¤©: æ–‡æ¡£æ’°å†™ + æ¼”ç¤ºå‡†å¤‡
ç¬¬8å¤©: å¯é€‰ - è®ºæ–‡ç‰ˆæœ¬ç®¡ç†
```

---

**ä¸Šæ¬¡ä¿®å¤æˆæœï¼š** mkdir/rmdir æƒé™é—®é¢˜å·²è§£å†³ âœ…
**å½“å‰ä»»åŠ¡ï¼š** é€‰æ‹©ä¼˜å…ˆçº§1ï¸âƒ£å¼€å§‹å®ç°è¡¥å……åŠŸèƒ½

